<div class="container mt-4">
  <h2>Registrar Venda</h2>

  <form (ngSubmit)="salvarVendas()" #vendaForm="ngForm">
    <!-- Comprador -->
   <!-- Comprador -->
<div class="mb-3">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <label class="form-label m-0">Comprador</label>
    <button 
      mdbBtn 
      color="dark" 
      rounded="true" 
      type="button" 
      (click)="mostrarFormComprador = !mostrarFormComprador">
      Criar novo comprador
    </button>
  </div>

  <div *ngIf="mostrarFormComprador" class="card p-3 mb-3 shadow-sm rounded-4">
    <form (ngSubmit)="criarComprador()">
      <div class="row g-2">
        <div class="col-md-4">
          <label for="nomeComprador" class="form-label">Nome</label>
          <input id="nomeComprador" type="text" class="form-control" [(ngModel)]="novoComprador.nome" name="nomeComprador" required />
        </div>
        <div class="col-md-4">
          <label for="cpfComprador" class="form-label">CPF</label>
          <input id="cpfComprador" type="text" class="form-control" [(ngModel)]="novoComprador.cpf" name="cpfComprador" required />
        </div>
        <div class="col-md-4">
          <label for="emailComprador" class="form-label">Email</label>
          <input id="emailComprador" type="email" class="form-control" [(ngModel)]="novoComprador.email" name="emailComprador" required />
        </div>
        <div class="col-12 d-flex gap-2 align-items-end mt-2">
          <button mdbBtn color="success" type="submit">‚úî</button>
          <button mdbBtn color="secondary" type="button" (click)="mostrarFormComprador = false">‚úñ</button>
        </div>
      </div>
    </form>
  </div>

  <select class="form-select" [(ngModel)]="compradorCpf" name="comprador" required>
    <option [ngValue]="null" disabled selected>Selecione um comprador</option>
    <option *ngFor="let c of compradores" [ngValue]="c.cpf">{{ c.nome }} - {{ c.cpf }}</option>
  </select>
</div>


    <!-- Usu√°rio Respons√°vel -->
    <div class="mb-3">
      <label class="form-label">Usu√°rio Respons√°vel</label>
      <select class="form-select" [(ngModel)]="usuarioResponsavelId" name="usuarioResponsavel" required>
        <option [ngValue]="null" disabled selected>Selecione um usu√°rio</option>
        <option *ngFor="let u of usuarios" [ngValue]="u.id">{{ u.nome }}</option>
      </select>
    </div>

    <!-- Adicionar itens -->
    <div class="row mb-3">
      <div class="col-md-5">
        <label class="form-label">Produto</label>
        <select class="form-select" [(ngModel)]="produtoId" name="produto" (change)="onProdutoChange()">
          <option [ngValue]="null" disabled selected>Selecione um produto</option>
          <option *ngFor="let p of produtos" [ngValue]="p.id">{{ p.nome }}</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Quantidade</label>
        <input type="number" class="form-control" [(ngModel)]="quantidade" name="quantidade" min="1" />
      </div>
      <div class="col-md-2">
        <label class="form-label">Pre√ßo Unit√°rio</label>
        <input type="number" class="form-control" [value]="precoUnitario" readonly />
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button mdbBtn color="success" rounded="true" type="button" (click)="adicionarItem()">Adicionar</button>
      </div>
    </div>

    <!-- Lista de itens -->
    <div class="mb-3">
      <label class="form-label">Itens da Venda</label>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Produto</th>
            <th>Quantidade</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of itensVenda; let i = index">
            <td>{{ getProdutoNome(item.produtoId) }}</td>
            <td>{{ item.quantidade }}</td>
            <td>
              <button mdbBtn size="sm" color="danger" rounded="true" type="button" (click)="removerItem(i)">üóëÔ∏è</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <button mdbBtn color="success" rounded="true" type="submit">üíæ Salvar Venda</button>
  </form>
</div>
